var cov_1rw9q2dha=function(){var path="/home/igorbag/Desktop/module-11 - istanbul/src/routes/authRoutes.js";var hash="6ca35adc505beb71c66c121c06a6d0b5ee8872dc";var Function=function(){}.constructor;var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/igorbag/Desktop/module-11 - istanbul/src/routes/authRoutes.js",statementMap:{"0":{start:{line:1,column:18},end:{line:1,column:45}},"1":{start:{line:2,column:12},end:{line:2,column:26}},"2":{start:{line:3,column:13},end:{line:3,column:28}},"3":{start:{line:4,column:23},end:{line:4,column:61}},"4":{start:{line:5,column:13},end:{line:8,column:1}},"5":{start:{line:9,column:12},end:{line:9,column:35}},"6":{start:{line:13,column:8},end:{line:13,column:15}},"7":{start:{line:14,column:8},end:{line:14,column:25}},"8":{start:{line:15,column:8},end:{line:15,column:20}},"9":{start:{line:20,column:8},end:{line:66,column:9}},"10":{start:{line:39,column:20},end:{line:39,column:35}},"11":{start:{line:42,column:14},end:{line:42,column:34}},"12":{start:{line:44,column:0},end:{line:44,column:18}},"13":{start:{line:46,column:31},end:{line:48,column:18}},"14":{start:{line:50,column:16},end:{line:52,column:17}},"15":{start:{line:51,column:20},end:{line:51,column:78}},"16":{start:{line:54,column:30},end:{line:54,column:91}},"17":{start:{line:56,column:16},end:{line:58,column:17}},"18":{start:{line:57,column:20},end:{line:57,column:76}},"19":{start:{line:60,column:16},end:{line:64,column:17}},"20":{start:{line:69,column:0},end:{line:69,column:27}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:12,column:4},end:{line:12,column:5}},loc:{start:{line:12,column:25},end:{line:16,column:5}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:18,column:4},end:{line:18,column:5}},loc:{start:{line:18,column:12},end:{line:67,column:5}},line:18},"2":{name:"(anonymous_2)",decl:{start:{line:35,column:21},end:{line:35,column:22}},loc:{start:{line:35,column:49},end:{line:65,column:13}},line:35}},branchMap:{"0":{loc:{start:{line:50,column:16},end:{line:52,column:17}},type:"if",locations:[{start:{line:50,column:16},end:{line:52,column:17}},{start:{line:50,column:16},end:{line:52,column:17}}],line:50},"1":{loc:{start:{line:56,column:16},end:{line:58,column:17}},type:"if",locations:[{start:{line:56,column:16},end:{line:58,column:17}},{start:{line:56,column:16},end:{line:58,column:17}}],line:56}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();const BaseRoute=(cov_1rw9q2dha.s[0]++,require('./base/baseRoute'));const Joi=(cov_1rw9q2dha.s[1]++,require('joi'));const Boom=(cov_1rw9q2dha.s[2]++,require('boom'));const PasswordHelper=(cov_1rw9q2dha.s[3]++,require('./../helpers/passwordHelper'));const USER=(cov_1rw9q2dha.s[4]++,{username:'xuxadasilva',password:'123'});const Jwt=(cov_1rw9q2dha.s[5]++,require('jsonwebtoken'));class AuthRoutes extends BaseRoute{constructor(key,db){cov_1rw9q2dha.f[0]++;cov_1rw9q2dha.s[6]++;super();cov_1rw9q2dha.s[7]++;this.secret=key;cov_1rw9q2dha.s[8]++;this.db=db;}login(){cov_1rw9q2dha.f[1]++;cov_1rw9q2dha.s[9]++;return{path:'/login',method:'POST',config:{auth:false,tags:['api'],description:'fazer login',notes:'retorna o token',validate:{payload:{username:Joi.string().required(),password:Joi.string().required()}}},handler:async(request,headers)=>{cov_1rw9q2dha.f[2]++;const{username,password}=(cov_1rw9q2dha.s[10]++,request.payload);const teste=(cov_1rw9q2dha.s[11]++,await this.db.read());cov_1rw9q2dha.s[12]++;console.log(teste);const[user]=(cov_1rw9q2dha.s[13]++,await this.db.read({username:username.toLowerCase()}));cov_1rw9q2dha.s[14]++;if(!user){cov_1rw9q2dha.b[0][0]++;cov_1rw9q2dha.s[15]++;return Boom.unauthorized('O usuario informado nao existe');}else{cov_1rw9q2dha.b[0][1]++;}const match=(cov_1rw9q2dha.s[16]++,await PasswordHelper.comparePassword(password,user.password));cov_1rw9q2dha.s[17]++;if(!match){cov_1rw9q2dha.b[1][0]++;cov_1rw9q2dha.s[18]++;return Boom.unauthorized('O usuario e senha invalidos!');}else{cov_1rw9q2dha.b[1][1]++;}cov_1rw9q2dha.s[19]++;return{token:Jwt.sign({username:username},this.secret)};}};}}cov_1rw9q2dha.s[20]++;module.exports=AuthRoutes;